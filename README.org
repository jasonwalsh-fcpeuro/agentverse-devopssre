#+TITLE: AgentVerse DevOps/SRE Infrastructure
#+AUTHOR: AgentVerse Team
#+DATE: 2025

[[https://img.shields.io/badge/GCP-Cloud%20Run-blue.svg]]
[[https://img.shields.io/badge/Container-Docker-2496ED.svg?logo=docker]]
[[https://img.shields.io/badge/Registry-Artifact%20Registry-4285F4.svg?logo=google-cloud]]
[[https://img.shields.io/badge/AI-Vertex%20AI-FF6F00.svg?logo=google-cloud]]
[[https://img.shields.io/badge/Model-Gemma-brightgreen.svg]]
[[https://img.shields.io/badge/Runtime-VLLM-orange.svg]]
[[https://img.shields.io/badge/Local-Ollama-black.svg]]
[[https://img.shields.io/badge/Status-Active-success.svg]]

* Overview

AgentVerse DevOps/SRE infrastructure for deploying and managing AI agents on Google Cloud Platform. This repository provides automated deployment pipelines, monitoring, and scaling for AI workloads using Cloud Run, Vertex AI, and local Ollama integration.

* Architecture Flow

#+begin_src
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Ollama    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Agent Hub   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Cloud Run  ‚îÇ
‚îÇ   (Local)   ‚îÇ     ‚îÇ              ‚îÇ     ‚îÇ  Services   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Artifact   ‚îÇ
                    ‚îÇ   Registry   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚ñº                ‚ñº
             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ   VLLM   ‚îÇ     ‚îÇ  Gemma   ‚îÇ
             ‚îÇ  Service ‚îÇ     ‚îÇ  Models  ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#+end_src

* Quick Start

** Prerequisites

- Google Cloud SDK installed and authenticated
- Docker installed and running
- Ollama (optional, for local development)
- Make utility
- Bash shell

** Setup

1. Clone the repository:
   #+begin_src bash
   git clone git@github.com:weimeilin79/agentverse-devopssre.git
   cd agentverse-devopssre
   #+end_src

2. Configure your GCP project:
   #+begin_src bash
   echo "your-project-id" > ~/project_id.txt
   #+end_src

3. Set up API keys securely (IMPORTANT):
   #+begin_src bash
   make setup-keys    # Interactive secure key setup
   #+end_src

4. Initialize environment:
   #+begin_src bash
   source set_env.sh
   #+end_src

5. Set up infrastructure:
   #+begin_src bash
   make setup
   #+end_src

* Environment Variables

| Variable | Description | Example |
|----------|-------------|---------|
| =PROJECT_ID= | GCP Project ID | =my-project-123= |
| =REGION= | GCP Region | =europe-west4= |
| =REPO_NAME= | Artifact Registry Repository | =agentverse-repo= |
| =OLLAMA_URL= | Ollama API Endpoint | =http://localhost:11434= |
| =VLLM_URL= | VLLM Service URL | =https://vllm-service.run.app= |
| =MODEL_ID= | Model Identifier | =google/gemma-3-1b-it= |

* Makefile Targets

#+begin_src bash
make help           # Show all available targets
make setup          # Complete setup (auth, repo, docker)
make validate       # Run all validation checks
make audit          # Perform security and config audit
make setup-keys     # Secure API key setup
make deploy         # Deploy services to Cloud Run
make clean          # Clean up resources
#+end_src

* System Validation

** Core Components Check

Run validation to ensure all components are properly configured:

#+begin_src bash
make validate
#+end_src

This checks:
- ‚úì GCloud authentication
- ‚úì Project configuration
- ‚úì Artifact Registry setup
- ‚úì Docker configuration
- ‚úì Ollama connectivity
- ‚úì Network configuration
- ‚úì IAM permissions

** Security Audit

Perform a security audit:

#+begin_src bash
make audit
#+end_src

Validates:
- API enablement
- Service account permissions
- Network security rules
- Secret management
- Container vulnerabilities

* Services

** Ollama Integration

Local Ollama instance for development:
- Auto-detected when running
- Falls back to Cloud Run when unavailable
- Models: qwen2.5, mistral, llama3.2-vision

** VLLM Service

High-performance inference engine:
- Optimized for Gemma models
- GPU acceleration
- Batch processing support

** Cloud Run Services

Managed serverless containers:
- Auto-scaling
- HTTPS endpoints
- Regional deployment

* Monitoring & Observability

** Logs

View service logs:
#+begin_src bash
gcloud logging read "resource.type=cloud_run_revision" --limit 50
#+end_src

** Metrics

Monitor service metrics:
#+begin_src bash
gcloud monitoring metrics-descriptors list --filter="metric.type:run.googleapis.com"
#+end_src

* Troubleshooting

** Common Issues

*** Authentication Failed
#+begin_src bash
gcloud auth login
gcloud auth application-default login
#+end_src

*** Docker Permission Denied
#+begin_src bash
gcloud auth configure-docker ${REGION}-docker.pkg.dev
#+end_src

*** Ollama Not Detected
#+begin_src bash
ollama serve  # Start Ollama service
make validate # Re-run validation
#+end_src

*** Build Failures
#+begin_src bash
gcloud builds list --limit=5  # Check recent builds
make clean && make setup       # Clean and retry
#+end_src

* Development Workflow

** Local Development

1. Start Ollama:
   #+begin_src bash
   ollama serve
   #+end_src

2. Set environment:
   #+begin_src bash
   source set_env.sh
   #+end_src

3. Run local tests:
   #+begin_src bash
   make test-local
   #+end_src

** Deployment

1. Build and push images:
   #+begin_src bash
   make build
   #+end_src

2. Deploy to Cloud Run:
   #+begin_src bash
   make deploy
   #+end_src

3. Validate deployment:
   #+begin_src bash
   make validate-deploy
   #+end_src

* Repository Structure

#+begin_src
.
‚îú‚îÄ‚îÄ Makefile              # Build and deployment automation
‚îú‚îÄ‚îÄ README.org            # This file
‚îú‚îÄ‚îÄ set_env.sh           # Environment configuration
‚îú‚îÄ‚îÄ warmup.sh            # Cache warming script
‚îú‚îÄ‚îÄ init.sh              # Initial setup script
‚îú‚îÄ‚îÄ cloudbuild-*.yaml    # Cloud Build configurations
‚îú‚îÄ‚îÄ agents/              # Agent implementations
‚îú‚îÄ‚îÄ services/            # Service configurations
‚îî‚îÄ‚îÄ tests/               # Test suites
#+end_src

* Contributing

** Fork Workflow

1. Fork the repository
2. Create feature branch
3. Make changes
4. Run validation: =make validate=
5. Submit pull request

** Development Guidelines

- Follow GCP best practices
- Maintain security standards
- Document all changes
- Include tests
- Update Makefile targets

* Security Considerations

** üîê API Key Management

**CRITICAL**: Never commit API keys to version control!

#+begin_src bash
make setup-keys     # Secure interactive setup
make audit          # Full security audit
make check-secrets  # Check for exposed secrets
#+end_src

** Supported API Keys

- **Hugging Face**: Required for model downloads
- **Google Gemini**: Required for Gemini API access  
- **OpenAI/Anthropic**: Optional for external models

** Security Features

- ‚úÖ Comprehensive .gitignore patterns
- ‚úÖ Automated secret scanning
- ‚úÖ Secure file permissions (600)
- ‚úÖ Environment variable validation
- ‚úÖ Git history scanning
- ‚úÖ Template-based setup

** Security Checklist

- [ ] Run =make setup-keys= for secure API key configuration
- [ ] Verify =.env= has 600 permissions
- [ ] Run =make audit= regularly
- [ ] Never commit =.env= files
- [ ] Rotate API keys every 90 days
- [ ] Monitor API usage dashboards

See [[./SECURITY.md][SECURITY.md]] for detailed security guidelines.

* License

[Specify your license here]

* Support

- Issues: [[https://github.com/weimeilin79/agentverse-devopssre/issues]]

* Links

- [[https://cloud.google.com/run][Google Cloud Run Documentation]]
- [[https://cloud.google.com/vertex-ai][Vertex AI Documentation]]
- [[https://ollama.ai][Ollama Documentation]]
- [[https://vllm.ai][VLLM Documentation]]